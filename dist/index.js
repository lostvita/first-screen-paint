!function(e,t){e.getElementById("livereloadscript")||((t=e.createElement("script")).async=1,t.src="//"+(window.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t))}(window.document),function(){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(){return!!(window.performance&&window.PerformanceObserver&&window.IntersectionObserver&&window.MutationObserver)}function u(e){console.warn(e)}var o=/style|script|link|br/i,e=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$data={},this.$iso=null,this.$muo=null,this.$perf=null,this._stopFlag=!1,this._stopTime=0,this._stepTime=0,this._timeOrigin=null,this._imgUrlList=new Set,this._resourceList=new Set,this.init()}var t,r,n;return t=e,(r=[{key:"initConfig",value:function(){this._stopFlag=!1,this._timeOrigin=performance.timeOrigin;var e={start:this._timeOrigin,end:null,duration:0};this.$data={fspt:e}}},{key:"initIsObserver",value:function(){var t=this,e=new IntersectionObserver(function(e){e.forEach(function(e){0<e.intersectionRatio&&(t.updateFspTime({duration:e.time}),(e=function(e){if(!/img/i.test(e)){e=window.getComputedStyle(e),e=(e.getPropertyValue("background-image")||e.getPropertyValue("background")).replace(/[\'\"]?/g,"").match(/(?<=^url\([\'\"]?).+(?=[\'\"]?\)$)/g);return e?e[0]:null}entry.target.getAttribute("data-src")}(e.target))&&t._imgUrlList.add(e))})});this.$iso=e}},{key:"initMuObserver",value:function(){var t=this,e=new MutationObserver(function(e){e&&e.forEach(function(e){e.addedNodes&&e.addedNodes.length&&e.addedNodes.forEach(function(e){1!==e.nodeType||o.test(e.nodeName)||t.$iso.observe(e)})})});e.observe(document,{childList:!0,subtree:!0}),this.$muo=e}},{key:"initPerfObserver",value:function(){var t=this,e=new PerformanceObserver(function(e){e.getEntriesByType("resource").forEach(function(e){t._stopFlag&&e.fetchStart>t._stopTime||(t._imgUrlList.has(e.name)&&(t.updateFspTime({duration:e.responseEnd}),t._imgUrlList.delete(e.name)),t._resourceList.add(e))})});e.observe({entryTypes:["resource"]}),this.$perf=e}},{key:"updateFspTime",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.start&&(this._stepTime=e.start,e.start+=this._timeOrigin),e.duration&&(e.duration-=this._stepTime,e.duration=Math.max(e.duration,this.$data.fspt.duration)),Object.assign(this.$data.fspt,e)}},{key:"stopObserver",value:function(){this._stopFlag||(this._stopTime=performance.now(),this._stopFlag=!0,this.$muo.disconnect(),this.$iso.disconnect(),this.$perf.disconnect())}},{key:"init",value:function(){var e=this;s()?(this.initConfig(),this.initIsObserver(),this.initMuObserver(),this.initPerfObserver(),window.addEventListener("scroll",function(){e.stopObserver()},{capture:!0,once:!0})):u("current browser doesn't support performance.")}},{key:"getFirstScreenTime",value:function(){var r=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5e3,i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new Promise(function(e,t){setTimeout(function(){i&&r.stopObserver(),r.updateFspTime({end:r.$data.fspt.start+r.$data.fspt.duration}),e(r.$data.fspt)},n)})}},{key:"getRequestTime",value:function(i){var s=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5e3,o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(i instanceof RegExp)return new Promise(function(n,e){setTimeout(function(){o&&s.stopObserver();var e=a(s._resourceList.values()).filter(function(e){return i.test(e.name)}).map(function(e){return{fetchStart:e.fetchStart,responseEnd:e.responseEnd,name:e.name}}).reduce(function(e,t){return e.start=Math.min(t.fetchStart,e.start||Number.MAX_SAFE_INTEGER),e.end=Math.max(t.responseEnd,e.end||0),e.request.push(t.name),e},{request:[]}),t=e.start,r=void 0===t?0:t,t=e.end,t=void 0===t?0:t,e=e.request;n({start:r+s.$data.fspt.start,end:t+s.$data.fspt.start,duration:t-r,request:e})},t)});u("missing format or format should be a regexp.")}},{key:"reopen",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document;this._stopFlag=!1,this.updateFspTime({start:performance.now(),duration:0}),this._imgUrlList.clear(),this._resourceList.clear(),this.$muo.observe(e,{childList:!0,subtree:!0}),this.$perf.observe({entryTypes:["resource"]})}}])&&i(t.prototype,r),n&&i(t,n),e}());s()&&(e={version:"1.0.0",getFirstScreenTime:e.getFirstScreenTime.bind(e),getRequestTime:e.getRequestTime.bind(e),reopen:e.reopen.bind(e)},window.$fsp=e)}();
