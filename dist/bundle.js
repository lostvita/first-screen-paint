!function(){"use strict";function t(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function e(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,r;t=n,e=o[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function s(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var a,u,r=/style|script|link|br/i,o=/img/i,i=/(?<=^url\([\'\"]?)\S+(?=[\'\"]?\)$)/g,c=window.performance&&window.PerformanceObserver&&window.IntersectionObserver&&window.MutationObserver,f=new Set,d=new Set,p=(a={$data:{},_stopFlag:!1,_stopTime:0,_stepTime:0,_timeOrigin:null,$iso:null,$muo:null,$perf:null},(u={_initConfig:function(){a._stopFlag=!1,a._timeOrigin=performance.timeOrigin;var e={start:a._timeOrigin,end:null,duration:0};a.$data={fst:e}},_initIsObserver:function(){var t=this,e=new IntersectionObserver(function(e){e.forEach(function(e){0<e.intersectionRatio&&(t._updateFstDur(e.time),(e=t._getImgSrc(e.target))&&f.add(e))})});a.$iso=e},_initMuObserver:function(){var e=new MutationObserver(function(e){e&&e.forEach(function(e){e.addedNodes&&e.addedNodes.length&&e.addedNodes.forEach(function(e){1!==e.nodeType||r.test(e.nodeName)||a.$iso.observe(e)})})});e.observe(document,{childList:!0,subtree:!0}),a.$muo=e},_initPerfObserver:function(){var t=this,e=new PerformanceObserver(function(e){e.getEntriesByType("resource").forEach(function(e){console.log(e.name,e.responseEnd),a._stopFlag&&e.fetchStart>a._stopTime||(f.has(e.name)&&(t._updateFstDur(e.responseEnd),f.delete(e.name)),d.add(e))})});e.observe({entryTypes:["resource"]}),a.$perf=e},_updateFstStart:function(){a._stepTime=performance.now(),a.$data.fst.start=a._timeOrigin+a._stepTime},_setFstDur:function(e){a.$data.fst.duration=e},_updateFstDur:function(e){e-=a._stepTime;var t=a.$data.fst.duration;a.$data.fst.duration=Math.max(t,e)},_stopObserver:function(){a._stopFlag||(a._stopTime=performance.now(),a._stopFlag=!0,a.$muo.disconnect(),a.$iso.disconnect(),a.$perf.disconnect())},_getImgSrc:function(e){if(!o.test(e)){e=window.getComputedStyle(e),e=(e.getPropertyValue("background-image")||e.getPropertyValue("background")).replace(/[\'\"]?/g,"").match(i);return e?e[0]:null}entry.target.getAttribute("data-src")},run:function(){var e=this;console.log(performance.now()),this._initConfig(),this._initIsObserver(),this._initMuObserver(),this._initPerfObserver(),window.addEventListener("scroll",function(){e._stopObserver()},{capture:!0,once:!0})}}).run(),e({version:"1.0.0"},{getFirstScreenTime:function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5e3,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new Promise(function(e,t){c?setTimeout(function(){n&&u._stopObserver(),a.$data.fst.end=a.$data.fst.start+a.$data.fst.duration,e(a.$data.fst)},r):t("current browser doesn't support performance.")})},getRequestTime:function(o){var e,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5e3,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return o instanceof RegExp?new Promise(function(n,e){c?setTimeout(function(){i&&u._stopObserver();var e=s(d.values()).filter(function(e){return o.test(e.name)}).map(function(e){return{fetchStart:e.fetchStart,responseEnd:e.responseEnd,name:e.name}}).reduce(function(e,t){return e.start=Math.min(t.fetchStart,e.start||Number.MAX_SAFE_INTEGER),e.end=Math.max(t.responseEnd,e.end||0),e.request.push(t.name),e},{request:[]}),t=e.start,r=void 0===t?0:t,t=e.end,t=void 0===t?0:t,e=e.request;n({start:r+a.$data.fst.start,end:t+a.$data.fst.start,duration:t-r,request:e})},t):e("current browser doesn't support performance.")}):(e="missing format or format should be a regexp.",void console.warn(e))},reopen:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document;a._stopFlag=!1,u._updateFstStart(),u._setFstDur(0),f.clear(),d.clear(),a.$muo.observe(e,{childList:!0,subtree:!0}),a.$perf.observe({entryTypes:["resource"]})}}));window.$fstp=p}();
